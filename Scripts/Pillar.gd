extends StaticBody2D

export var can_disappear : bool = false

export var PlayerNodePath : NodePath = "../Player"
var player : KinematicBody2D

export(String, FILE, "*.tscn,*.scn") var particle_path = "res://Scenes/Particles/PillarParticles.tscn"
onready var particles = load(particle_path)
var emit : bool = false

export var thresh_dist : float = 25.0


func _ready() -> void:
	player = get_node(PlayerNodePath)
	$Sprite.visible = false
	$Collision.disabled = true
	
func _process(_delta) -> void:
	var distance = player.global_position - Vector2(global_position.x+15, global_position.y)
	
	if abs(distance.x) <= thresh_dist:
		if $Collision.disabled:
			$Sprite.visible = true
			$Collision.disabled = false
			emit = true
	else:
		if !$Collision.disabled and can_disappear:
			$Sprite.visible = false
			$Collision.disabled = true
			emit = true
	
	if emit:
		$Sound.play()
		emit = false
		var p = particles.instance()
		p.global_position = Vector2(15, -25)
		add_child(p)
		
